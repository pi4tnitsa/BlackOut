#!/bin/bash

echo "üöÄ Nuclei Scanner - –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫"
echo "================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –û–°
if [[ "$OSTYPE" != "linux-gnu"* ]]; then
    echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Linux"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
if [[ $EUID -ne 0 ]]; then
   echo "‚ùå –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø—Ä–∞–≤–∞–º–∏ root: sudo $0"
   exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
if [ ! -f "deploy.sh" ]; then
    echo "‚ùå –§–∞–π–ª deploy.sh –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

if [ ! -f "worker-deploy.sh" ]; then
    echo "‚ùå –§–∞–π–ª worker-deploy.sh –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏:"
echo "1) üè¢ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∫–∞)"
echo "2) üë∑ –í–æ—Ä–∫–µ—Ä (–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å–µ—Ä–≤–µ—Ä—É)"
echo "3) üîß –í—Å—ë –≤ –æ–¥–Ω–æ–º (—Ç–µ—Å—Ç–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)"
echo "4) üß™ –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo ""
read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-4): " choice

case $choice in
    1)
        echo ""
        echo "üè¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
        echo "===================================="
        chmod +x deploy.sh
        ./deploy.sh
        
        echo ""
        echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        echo ""
        echo "üåê –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ:"
        echo "  URL: http://$(hostname -I | awk '{print $1}')"
        echo "  –õ–æ–≥–∏–Ω: admin"
        echo "  –ü–∞—Ä–æ–ª—å: nuclei_admin_2024!"
        ;;
        
    2)
        echo ""
        echo "üë∑ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞..."
        echo "======================"
        read -p "IP —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: " central_ip
        
        if [ -z "$central_ip" ]; then
            echo "‚ùå IP —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"
            exit 1
        fi
        
        chmod +x worker-deploy.sh
        echo "$central_ip" | ./worker-deploy.sh
        
        echo ""
        echo "‚úÖ –í–æ—Ä–∫–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
        echo ""
        echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
        echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω"
        echo "2. –î–æ–±–∞–≤—å—Ç–µ –≤–æ—Ä–∫–µ—Ä —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
        echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -f /var/log/nuclei-worker/worker.out.log"
        ;;
        
    3)
        echo ""
        echo "üîß –¢–µ—Å—Ç–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–≤—Å—ë –≤ –æ–¥–Ω–æ–º)..."
        echo "====================================="
        
        # –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
        chmod +x deploy.sh
        ./deploy.sh
        
        echo ""
        echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
        sleep 10
        
        # –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä
        echo ""
        echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞..."
        chmod +x worker-deploy.sh
        echo -e "127.0.0.1\n1\nlocalhost\nbelarus" | ./worker-deploy.sh
        
        echo ""
        echo "‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
        echo ""
        echo "üåê –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ:"
        echo "  URL: http://localhost"
        echo "  –õ–æ–≥–∏–Ω: admin"
        echo "  –ü–∞—Ä–æ–ª—å: nuclei_admin_2024!"
        echo ""
        echo "üìã –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
        echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
        echo "2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"
        echo "3. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π IP (–Ω–∞–ø—Ä–∏–º–µ—Ä, 127.0.0.1)"
        ;;
        
    4)
        echo ""
        echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
        echo "========================"
        
        if [ -f "test_system.py" ]; then
            python3 test_system.py
        elif [ -f "test_connectivity.py" ]; then
            python3 test_connectivity.py
        else
            echo "‚ùå –§–∞–π–ª—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
            exit 1
        fi
        ;;
        
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac

echo ""
echo "üéâ –ì–æ—Ç–æ–≤–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Nuclei Scanner!"