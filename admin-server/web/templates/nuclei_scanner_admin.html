<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuclei Scanner - Панель управления</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
        }
        
        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: .5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .severity-critical { color: #dc3545; font-weight: bold; }
        .severity-high { color: #fd7e14; font-weight: bold; }
        .severity-medium { color: #ffc107; font-weight: bold; }
        .severity-low { color: #20c997; }
        .severity-info { color: #0dcaf0; }
        
        .status-online { color: #198754; }
        .status-offline { color: #dc3545; }
        .status-unknown { color: #6c757d; }
        
        .card-stats {
            transition: transform 0.2s;
        }
        
        .card-stats:hover {
            transform: translateY(-2px);
        }
        
        .vulnerability-card {
            border-left: 4px solid;
        }
        
        .vulnerability-card.critical { border-left-color: #dc3545; }
        .vulnerability-card.high { border-left-color: #fd7e14; }
        .vulnerability-card.medium { border-left-color: #ffc107; }
        .vulnerability-card.low { border-left-color: #20c997; }
        .vulnerability-card.info { border-left-color: #0dcaf0; }
        
        .nav-link.active {
            background-color: #007bff;
            color: white;
        }
        
        main {
            margin-left: 240px;
        }
        
        @media (max-width: 768px) {
            main {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Навигационная панель -->
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">
            <i class="fas fa-shield-alt"></i> Nuclei Scanner
        </a>
        
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="navbar-nav">
            <div class="nav-item text-nowrap">
                <a class="nav-link px-3" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Выход
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Боковая панель -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3 sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showPage('dashboard')">
                                <i class="fas fa-tachometer-alt"></i> Дашборд
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('servers')">
                                <i class="fas fa-server"></i> Серверы
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('tasks')">
                                <i class="fas fa-tasks"></i> Задачи
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('vulnerabilities')">
                                <i class="fas fa-bug"></i> Уязвимости
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Основное содержимое -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Уведомления -->
                <div id="notifications"></div>
                
                <!-- Дашборд -->
                <div id="page-dashboard" class="page-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tachometer-alt"></i> Дашборд</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshDashboard()">
                                    <i class="fas fa-sync-alt"></i> Обновить
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Статистические карточки -->
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2 card-stats">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Всего уязвимостей
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-vulnerabilities">
                                                0
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-bug fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-danger shadow h-100 py-2 card-stats">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                                Критические
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="critical-vulnerabilities">
                                                0
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2 card-stats">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Серверы онлайн
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="online-servers">
                                                0 / 0
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-server fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2 card-stats">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Активные задачи
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="active-tasks">
                                                0
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-tasks fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Графики -->
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-chart-area"></i> Уязвимости по критичности
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="severityChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-server"></i> Статус серверов
                                    </h6>
                                </div>
                                <div class="card-body" id="servers-status">
                                    <p class="text-muted">Загрузка...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Серверы -->
                <div id="page-servers" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-server"></i> Управление серверами</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addServerModal">
                                    <i class="fas fa-plus"></i> Добавить сервер
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshServers()">
                                    <i class="fas fa-sync-alt"></i> Обновить
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="servers-list">
                        <div class="col-12">
                            <p class="text-muted">Загрузка серверов...</p>
                        </div>
                    </div>
                </div>

                <!-- Задачи -->
                <div id="page-tasks" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tasks"></i> Управление задачами</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#createTaskModal">
                                    <i class="fas fa-plus"></i> Создать задачу
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshTasks()">
                                    <i class="fas fa-sync-alt"></i> Обновить
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">Список задач сканирования</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="tasks-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Статус</th>
                                            <th>IP-диапазоны</th>
                                            <th>Серверы</th>
                                            <th>Создана</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="text-center">Загрузка задач...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Уязвимости -->
                <div id="page-vulnerabilities" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-bug"></i> Найденные уязвимости</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="exportVulnerabilities('json')">
                                    <i class="fas fa-download"></i> JSON
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="exportVulnerabilities('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshVulnerabilities()">
                                    <i class="fas fa-sync-alt"></i> Обновить
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Фильтры -->
                    <div class="card shadow mb-4">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">Фильтры</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">База данных</label>
                                    <select class="form-select" id="filter-database">
                                        <option value="belarus">Беларусь</option>
                                        <option value="russia">Россия</option>
                                        <option value="kazakhstan">Казахстан</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">IP-адрес</label>
                                    <input type="text" class="form-control" id="filter-ip" placeholder="192.168.1.1">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Критичность</label>
                                    <select class="form-select" id="filter-severity">
                                        <option value="">Все</option>
                                        <option value="critical">Критические</option>
                                        <option value="high">Высокие</option>
                                        <option value="medium">Средние</option>
                                        <option value="low">Низкие</option>
                                        <option value="info">Информационные</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">&nbsp;</label>
                                    <div class="d-grid">
                                        <button type="button" class="btn btn-primary" onclick="applyVulnFilters()">
                                            <i class="fas fa-search"></i> Применить
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">Список уязвимостей</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover" id="vulnerabilities-table">
                                    <thead>
                                        <tr>
                                            <th>IP-адрес</th>
                                            <th>Шаблон</th>
                                            <th>Критичность</th>
                                            <th>URL</th>
                                            <th>Время</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="6" class="text-center">Загрузка уязвимостей...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Модальные окна -->
    
    <!-- Добавление сервера -->
    <div class="modal fade" id="addServerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить новый сервер</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Имя хоста</label>
                        <input type="text" class="form-control" id="server-hostname" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">IP-адрес</label>
                        <input type="text" class="form-control" id="server-ip" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">SSH порт</label>
                        <input type="number" class="form-control" id="server-port" value="22" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="button" class="btn btn-primary" onclick="addServer()">Добавить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Создание задачи -->
    <div class="modal fade" id="createTaskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Создать новую задачу</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Название задачи</label>
                        <input type="text" class="form-control" id="task-name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">База данных</label>
                        <select class="form-select" id="task-database" required>
                            <option value="belarus">Беларусь</option>
                            <option value="russia">Россия</option>
                            <option value="kazakhstan">Казахстан</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">IP-диапазоны</label>
                        <textarea class="form-control" id="task-ips" rows="8" placeholder="Введите IP-диапазоны (по одному на строку):&#10;192.168.1.0/24&#10;10.0.0.1-10.0.0.100&#10;172.16.1.1" required></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Выберите серверы</label>
                        <div class="border rounded p-3" id="task-servers-list" style="max-height: 200px; overflow-y: auto;">
                            <p class="text-muted">Загрузка списка серверов...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="button" class="btn btn-primary" onclick="createTask()">Создать задачу</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Терминал -->
    <div class="modal fade" id="terminalModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Терминал сервера</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="terminal-command" placeholder="Введите команду...">
                            <button class="btn btn-primary" type="button" onclick="executeCommand()">
                                <i class="fas fa-play"></i> Выполнить
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <pre id="terminal-output" class="bg-dark text-light p-3" style="height: 300px; overflow-y: scroll;">Результат команды появится здесь...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Глобальные переменные
        let currentPage = 'dashboard';
        let currentServerId = null;
        let mockData = {
            servers: [
                {id: 1, hostname: 'scanner-01', ip_address: '192.168.1.101', status: 'online', ssh_port: 22, last_seen: '2024-01-15 14:30:00'},
                {id: 2, hostname: 'scanner-02', ip_address: '192.168.1.102', status: 'offline', ssh_port: 22, last_seen: '2024-01-15 12:15:00'}
            ],
            tasks: [
                {id: 1, name: 'Сканирование офисной сети', status: 'running', target_ips: ['192.168.1.0/24'], server_ids: [1], created_at: '2024-01-15 14:00:00'},
                {id: 2, name: 'Проверка внешних серверов', status: 'pending', target_ips: ['203.0.113.0/24'], server_ids: [1,2], created_at: '2024-01-15 13:45:00'}
            ],
            vulnerabilities: [
                {id: 1, ip_address: '192.168.1.50', template_method: 'http-missing-security-headers', severity_level: 'medium', url: 'http://192.168.1.50', timestamp: '2024-01-15 14:25:00'},
                {id: 2, ip_address: '192.168.1.51', template_method: 'ssl-tls-ciphers', severity_level: 'high', url: 'https://192.168.1.51', timestamp: '2024-01-15 14:20:00'},
                {id: 3, ip_address: '192.168.1.52', template_method: 'exposed-panel-phpmyadmin', severity_level: 'critical', url: 'http://192.168.1.52/phpmyadmin', timestamp: '2024-01-15 14:15:00'}
            ],
            stats: {
                total: 3,
                critical: 1,
                high: 1,
                medium: 1,
                low: 0,
                info: 0,
                unique_ips: 3
            }
        };

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            loadPage('dashboard');
            setInterval(autoRefresh, 30000); // Автообновление каждые 30 секунд
        });

        // Навигация между страницами
        function showPage(pageId) {
            // Скрываем все страницы
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Убираем активный класс со всех ссылок
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Показываем выбранную страницу
            document.getElementById(`page-${pageId}`).style.display = 'block';
            
            // Добавляем активный класс
            document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.add('active');
            
            currentPage = pageId;
            loadPage(pageId);
        }

        // Загрузка контента страницы
        function loadPage(pageId) {
            switch(pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'servers':
                    loadServers();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'vulnerabilities':
                    loadVulnerabilities();
                    break;
            }
        }

        // Загрузка дашборда
        function loadDashboard() {
            updateDashboardStats();
            updateServersStatus();
            createSeverityChart();
        }

        function updateDashboardStats() {
            const stats = mockData.stats;
            const onlineServers = mockData.servers.filter(s => s.status === 'online').length;
            const totalServers = mockData.servers.length;
            const activeTasks = mockData.tasks.filter(t => t.status === 'running').length;

            document.getElementById('total-vulnerabilities').textContent = stats.total;
            document.getElementById('critical-vulnerabilities').textContent = stats.critical;
            document.getElementById('online-servers').textContent = `${onlineServers} / ${totalServers}`;
            document.getElementById('active-tasks').textContent = activeTasks;
        }

        function updateServersStatus() {
            const container = document.getElementById('servers-status');
            let html = '';
            
            mockData.servers.forEach(server => {
                const statusClass = server.status === 'online' ? 'success' : 'danger';
                const statusIcon = server.status === 'online' ? 'check-circle' : 'times-circle';
                
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <strong>${server.hostname}</strong><br>
                            <small class="text-muted">${server.ip_address}</small>
                        </div>
                        <span class="badge bg-${statusClass}">
                            <i class="fas fa-${statusIcon}"></i> ${server.status}
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function createSeverityChart() {
            const ctx = document.getElementById('severityChart').getContext('2d');
            const stats = mockData.stats;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Критические', 'Высокие', 'Средние', 'Низкие', 'Информационные'],
                    datasets: [{
                        data: [stats.critical, stats.high, stats.medium, stats.low, stats.info],
                        backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#20c997', '#0dcaf0']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Загрузка серверов
        function loadServers() {
            const container = document.getElementById('servers-list');
            let html = '';
            
            mockData.servers.forEach(server => {
                const statusClass = server.status === 'online' ? 'success' : 'danger';
                
                html += `
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="card shadow h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold">${server.hostname}</h6>
                                <span class="badge bg-${statusClass}">${server.status.toUpperCase()}</span>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <small class="text-muted">IP-адрес:</small><br>
                                    <strong>${server.ip_address}</strong>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">SSH порт:</small><br>
                                    <strong>${server.ssh_port}</strong>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Последняя активность:</small><br>
                                    <small>${server.last_seen}</small>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group btn-group-sm w-100" role="group">
                                    <button type="button" class="btn btn-outline-info" onclick="showServerDetails(${server.id})">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-success" onclick="installNuclei(${server.id})">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-warning" onclick="updateTemplates(${server.id})">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="showTerminal(${server.id})">
                                        <i class="fas fa-terminal"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Загрузка задач
        function loadTasks() {
            const tbody = document.querySelector('#tasks-table tbody');
            let html = '';
            
            if (mockData.tasks.length === 0) {
                html = '<tr><td colspan="7" class="text-center">Задачи не найдены</td></tr>';
            } else {
                mockData.tasks.forEach(task => {
                    const statusClass = getStatusClass(task.status);
                    
                    html += `
                        <tr>
                            <td>${task.id}</td>
                            <td>${task.name}</td>
                            <td><span class="badge bg-${statusClass}">${task.status.toUpperCase()}</span></td>
                            <td><small>${task.target_ips.length} диапазон(ов)</small></td>
                            <td><small>${task.server_ids.length} сервер(ов)</small></td>
                            <td><small>${task.created_at}</small></td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    ${task.status === 'pending' ? 
                                        `<button type="button" class="btn btn-outline-success" onclick="startTask(${task.id})">
                                            <i class="fas fa-play"></i>
                                        </button>` : ''}
                                    <button type="button" class="btn btn-outline-info" onclick="showTaskDetails(${task.id})">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tbody.innerHTML = html;
            
            // Загружаем список серверов для модального окна создания задачи
            loadServersForTaskModal();
        }

        function loadServersForTaskModal() {
            const container = document.getElementById('task-servers-list');
            let html = '';
            
            mockData.servers.forEach(server => {
                const statusClass = server.status === 'online' ? 'success' : 'danger';
                html += `
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="${server.id}" id="server${server.id}">
                        <label class="form-check-label" for="server${server.id}">
                            ${server.hostname} (${server.ip_address})
                            <span class="badge bg-${statusClass} ms-1">${server.status}</span>
                        </label>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Загрузка уязвимостей
        function loadVulnerabilities() {
            const tbody = document.querySelector('#vulnerabilities-table tbody');
            let html = '';
            
            if (mockData.vulnerabilities.length === 0) {
                html = '<tr><td colspan="6" class="text-center">Уязвимости не найдены</td></tr>';
            } else {
                mockData.vulnerabilities.forEach(vuln => {
                    const severityClass = getSeverityClass(vuln.severity_level);
                    
                    html += `
                        <tr>
                            <td><strong>${vuln.ip_address}</strong></td>
                            <td><code>${vuln.template_method}</code></td>
                            <td><span class="badge bg-${severityClass}">${vuln.severity_level.toUpperCase()}</span></td>
                            <td>
                                <a href="${vuln.url}" target="_blank" class="text-decoration-none">
                                    ${vuln.url.length > 50 ? vuln.url.substring(0, 50) + '...' : vuln.url}
                                    <i class="fas fa-external-link-alt fa-xs"></i>
                                </a>
                            </td>
                            <td><small>${vuln.timestamp}</small></td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-info" onclick="showVulnDetails(${vuln.id})">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tbody.innerHTML = html;
        }

        // Утилиты
        function getStatusClass(status) {
            switch(status) {
                case 'completed': return 'success';
                case 'running': return 'primary';
                case 'pending': return 'secondary';
                case 'failed': return 'danger';
                default: return 'secondary';
            }
        }

        function getSeverityClass(severity) {
            switch(severity) {
                case 'critical': return 'danger';
                case 'high': return 'warning';
                case 'medium': return 'info';
                case 'low': return 'success';
                case 'info': return 'secondary';
                default: return 'secondary';
            }
        }

        // Функции управления
        function addServer() {
            const hostname = document.getElementById('server-hostname').value;
            const ip = document.getElementById('server-ip').value;
            const port = document.getElementById('server-port').value;
            
            if (!hostname || !ip || !port) {
                showNotification('Заполните все поля', 'danger');
                return;
            }
            
            // Добавляем сервер в mock данные
            const newServer = {
                id: mockData.servers.length + 1,
                hostname: hostname,
                ip_address: ip,
                ssh_port: parseInt(port),
                status: 'offline',
                last_seen: 'Никогда'
            };
            
            mockData.servers.push(newServer);
            
            // Очищаем форму
            document.getElementById('server-hostname').value = '';
            document.getElementById('server-ip').value = '';
            document.getElementById('server-port').value = '22';
            
            // Закрываем модальное окно
            bootstrap.Modal.getInstance(document.getElementById('addServerModal')).hide();
            
            showNotification(`Сервер ${hostname} успешно добавлен`, 'success');
            
            if (currentPage === 'servers') {
                loadServers();
            }
        }

        function createTask() {
            const name = document.getElementById('task-name').value;
            const database = document.getElementById('task-database').value;
            const ips = document.getElementById('task-ips').value;
            const selectedServers = Array.from(document.querySelectorAll('#task-servers-list input:checked')).map(cb => parseInt(cb.value));
            
            if (!name || !ips || selectedServers.length === 0) {
                showNotification('Заполните все поля и выберите серверы', 'danger');
                return;
            }
            
            // Создаем задачу
            const newTask = {
                id: mockData.tasks.length + 1,
                name: name,
                status: 'pending',
                target_ips: ips.split('\n').filter(ip => ip.trim()),
                server_ids: selectedServers,
                created_at: new Date().toLocaleString('ru-RU')
            };
            
            mockData.tasks.push(newTask);
            
            // Очищаем форму
            document.getElementById('task-name').value = '';
            document.getElementById('task-ips').value = '';
            document.querySelectorAll('#task-servers-list input').forEach(cb => cb.checked = false);
            
            // Закрываем модальное окно
            bootstrap.Modal.getInstance(document.getElementById('createTaskModal')).hide();
            
            showNotification(`Задача "${name}" успешно создана`, 'success');
            
            if (currentPage === 'tasks') {
                loadTasks();
            }
        }

        function startTask(taskId) {
            const task = mockData.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'running';
                showNotification(`Задача "${task.name}" запущена`, 'success');
                if (currentPage === 'tasks') {
                    loadTasks();
                }
            }
        }

        function showServerDetails(serverId) {
            const server = mockData.servers.find(s => s.id === serverId);
            if (server) {
                showNotification(`Детали сервера: ${server.hostname} (${server.ip_address})`, 'info');
            }
        }

        function installNuclei(serverId) {
            const server = mockData.servers.find(s => s.id === serverId);
            if (server) {
                showNotification(`Начата установка Nuclei на ${server.hostname}`, 'info');
                // Симуляция установки
                setTimeout(() => {
                    showNotification(`Nuclei успешно установлен на ${server.hostname}`, 'success');
                }, 3000);
            }
        }

        function updateTemplates(serverId) {
            const server = mockData.servers.find(s => s.id === serverId);
            if (server) {
                showNotification(`Обновление шаблонов на ${server.hostname}`, 'info');
                // Симуляция обновления
                setTimeout(() => {
                    showNotification(`Шаблоны обновлены на ${server.hostname}`, 'success');
                }, 2000);
            }
        }

        function showTerminal(serverId) {
            currentServerId = serverId;
            const server = mockData.servers.find(s => s.id === serverId);
            if (server) {
                document.querySelector('#terminalModal .modal-title').textContent = `Терминал: ${server.hostname}`;
                document.getElementById('terminal-command').value = '';
                document.getElementById('terminal-output').textContent = 'Подключение к серверу...';
                new bootstrap.Modal(document.getElementById('terminalModal')).show();
            }
        }

        function executeCommand() {
            const command = document.getElementById('terminal-command').value.trim();
            if (!command) {
                showNotification('Введите команду!', 'danger');
                return;
            }
            
            const output = document.getElementById('terminal-output');
            output.textContent = `$ ${command}\nВыполнение команды...\n`;
            
            // Симуляция выполнения команды
            setTimeout(() => {
                let result = '';
                switch(command.toLowerCase()) {
                    case 'uptime':
                        result = 'up 5 days, 12:34, 1 user, load average: 0.15, 0.20, 0.18';
                        break;
                    case 'nuclei -version':
                        result = 'Nuclei Engine Version: v2.9.4';
                        break;
                    case 'ps aux | grep nuclei':
                        result = 'nuclei-worker  1234  0.5  2.1  123456  54321 ?  S  14:30  0:05 python worker.py';
                        break;
                    default:
                        result = `Command '${command}' executed successfully`;
                }
                output.textContent = `$ ${command}\n${result}\n\nГотов к выполнению следующей команды...`;
            }, 1500);
        }

        function showTaskDetails(taskId) {
            const task = mockData.tasks.find(t => t.id === taskId);
            if (task) {
                showNotification(`Задача: ${task.name}, Статус: ${task.status}`, 'info');
            }
        }

        function showVulnDetails(vulnId) {
            const vuln = mockData.vulnerabilities.find(v => v.id === vulnId);
            if (vuln) {
                showNotification(`Уязвимость: ${vuln.template_method} на ${vuln.ip_address}`, 'warning');
            }
        }

        function applyVulnFilters() {
            const database = document.getElementById('filter-database').value;
            const ip = document.getElementById('filter-ip').value;
            const severity = document.getElementById('filter-severity').value;
            
            showNotification(`Применены фильтры: БД=${database}, IP=${ip || 'все'}, Критичность=${severity || 'все'}`, 'info');
            loadVulnerabilities();
        }

        function exportVulnerabilities(format) {
            showNotification(`Экспорт уязвимостей в формате ${format.toUpperCase()}`, 'info');
            // Здесь должна быть логика экспорта
        }

        // Функции обновления
        function refreshDashboard() {
            showNotification('Обновление дашборда...', 'info');
            loadDashboard();
        }

        function refreshServers() {
            showNotification('Обновление списка серверов...', 'info');
            loadServers();
        }

        function refreshTasks() {
            showNotification('Обновление списка задач...', 'info');
            loadTasks();
        }

        function refreshVulnerabilities() {
            showNotification('Обновление списка уязвимостей...', 'info');
            loadVulnerabilities();
        }

        function autoRefresh() {
            if (currentPage === 'dashboard') {
                updateDashboardStats();
                updateServersStatus();
            }
        }

        function logout() {
            if (confirm('Вы уверены, что хотите выйти из системы?')) {
                showNotification('Выход из системы...', 'info');
                // Здесь должна быть логика выхода
            }
        }

        // Показ уведомлений
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            container.appendChild(alertDiv);
            
            // Автоматическое скрытие через 5 секунд
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Обработчик Enter для терминала
        document.addEventListener('keypress', function(e) {
            if (e.target.id === 'terminal-command' && e.key === 'Enter') {
                executeCommand();
            }
        });

        // Симуляция изменения статусов (для демонстрации)
        setInterval(() => {
            // Случайно меняем статус серверов
            mockData.servers.forEach(server => {
                if (Math.random() < 0.1) { // 10% вероятность изменения
                    server.status = server.status === 'online' ? 'offline' : 'online';
                    server.last_seen = new Date().toLocaleString('ru-RU');
                }
            });
            
            // Обновляем статистику уязвимостей
            if (Math.random() < 0.2) { // 20% вероятность новой уязвимости
                const severities = ['info', 'low', 'medium', 'high', 'critical'];
                const templates = ['http-missing-security-headers', 'ssl-weak-cipher', 'exposed-admin-panel', 'xss-reflected', 'sql-injection'];
                
                const newVuln = {
                    id: mockData.vulnerabilities.length + 1,
                    ip_address: `192.168.1.${Math.floor(Math.random() * 254) + 1}`,
                    template_method: templates[Math.floor(Math.random() * templates.length)],
                    severity_level: severities[Math.floor(Math.random() * severities.length)],
                    url: `http://192.168.1.${Math.floor(Math.random() * 254) + 1}`,
                    timestamp: new Date().toLocaleString('ru-RU')
                };
                
                mockData.vulnerabilities.unshift(newVuln);
                
                // Обновляем статистику
                mockData.stats.total++;
                mockData.stats[newVuln.severity_level]++;
                
                if (mockData.vulnerabilities.length > 10) {
                    mockData.vulnerabilities = mockData.vulnerabilities.slice(0, 10);
                }
            }
            
            // Автоматически завершаем запущенные задачи
            mockData.tasks.forEach(task => {
                if (task.status === 'running' && Math.random() < 0.3) {
                    task.status = 'completed';
                }
            });
            
        }, 10000); // Каждые 10 секунд
    </script>
</body>
</html>
                        